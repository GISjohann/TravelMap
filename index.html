
<html>
<head> 
<title>Travel Map</title>
<!-- Include Leaflet CSS and JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Fullscreen plugin CSS and JS -->
<link rel="stylesheet" href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css" />
<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>

<!-- JQuery -->
<script src="jquery-2.1.1.min.js"></script> 

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
<style>
:root {
--myyellow: #f2c91c; /* rgb(242, 201, 28); */
--newyellow:#ffb02e;
}


html, body {
height: 100%;
margin: 0;
font-family: Arial, Helvetica, sans-serif
}

header {
width: 100%; /* Full width */
background-color: yellow; /* Background color */
padding: 10px; /* Space inside the header */
box-sizing: border-box;
z-index: 1000; /* Ensure it stays above other content */

}

body {
background-color: yellow; /* Background color */
display: flex; /* used to say block;*/
flex-direction: column;
justify-content: center;
align-items: center;
height: 100vh; /* 100% of the viewport height */

}

#map{ /*used to be called top-div, with map css following*/
border: 2px solid black;
position: relative; /* Set the map's position to relative */
width: 100%;   /*The map should take up the full width of its container */
height: 100%;
    pointer-events: auto !important;  /* Allows interaction with the popup */
    touch-action: auto;  /* Allows interaction with the popup */

}


/*width: 1200px;
   height: 850px; /*can#t go more than this for some reason*/
/*background-color: white;/*
	}  

 /* Ensure the map container is set to fill the available screen space 
     #map {
       width: 100%;   The map should take up the full width of its container 
       height: 100%;
}

	    #bottom-div {
           width: 100%;
           height: 10px;
           background-color: var(--myyellow);
	}	
*/
#nameList {
background-color: yellow;
position: relative;
justify-content: center;
height: fit-content; /* Set a fixed height to allow scrolling */
padding-left: 40px;
overflow-y: auto; /* Allow vertical scrolling */
font-family: Mochiy Pop One;
}

/* Style for individual name items */
.name-item {
width:200px;
padding: 10px;
margin-bottom: 7px;
background-color: var(--newyellow); 
border-radius: 4px; /* Slightly rounded corners for each item */
border: 2px solid black;
text-align: center;
cursor: pointer;
transition: background-color 0.3s ease; /* Smooth transition for hover effect */
font-size: 14px; /* Set a reasonable font size */
color: black;
}

/* Hover effect for name items */
.name-item:hover { 
transform: scaleY(1.2);
transform: scaleX(1.1);

}



h1 {
color: black;
font-family: Mochiy Pop One;
font-size: 400%;
text-align: center;
margin: 0;
}

h2 {
color: black;
font-family: Mochiy Pop One;
font-size: 250%;
text-align: center;
margin: 0;
}
p {
color: black;
font-family: Arial, Helvetica, sans-serif;
font-weight: bold; /* Bold text */
}
.mochiy-pop-one-regular {
font-family: "Mochiy Pop One", sans-serif;
font-weight: 400;
font-style: normal;
}


.leaflet-touch .leaflet-control-layers, .leaflet-touch .leaflet-bar {
border: #00000000;
background-clip: padding-box; /* removes ugly box around the buttons */
}

/* Change the popup background color and text color */
.leaflet-tooltip {
margin-top: -30px; /* Move tooltip content 30px up */
background-color:yellow; 
border-radius: 6px; /* Rounded corners */
border: 2px solid black;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
text-align: center;  /* Center the content */
color: black; /* Dark text */
font-size: 12pt;
font-weight: bold; /* Bold text */
font-family: Mochiy Pop One;
} 

/* Custom popup style on the right side inside the map frame */
.leaflet-right-popup {
position: absolute;
display: block; /* Ensure it's not hidden */
visibility: visible;
width:25vw;/*fit-content;*/
max-width:50vw !important; /* Set the width to 30% of the map's width */ 
right: 0px;
top: 5px;/*this is offset*/
background: yellow;
border: 2px solid black;
padding: 10px; /*inside content*/
border-radius: 6px; /* Rounded corners */
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
z-index: 9999;

/* Scrollbar settings     height: fit-content;*/

height: 70vh !important; /*Adjust this value to control the popup height */
overflow-y: auto !important; 
/*overflow-y:auto;  Add vertical scroll if content overflows */

}


/* Style for the popup content inside */
.leaflet-popup-content {
/*max-height: 50vh; /* Limit the content height */
/* Allow scrolling inside the popup if content exceeds the height */
word-wrap: break-word; /* Ensure long text breaks to fit inside the container */
}



/* WebKit browsers */
#nameList::-webkit-scrollbar {
width: 30px; /* Width of the scrollbar */
border-radius: 8px; /* Round the scrollbar to match the popup */
}

#nameList::-webkit-scrollbar-thumb {
background-color: rgba(0, 0, 0, 0.5); /* Color of the scrollbar thumb */
border-radius: 8px; /* Match the rounded corners */
}

#nameList::-webkit-scrollbar-track {
background: yellow; /* Transparent track to blend with the background */
border-radius: 8px; /* Round the track as well */
}

/* For Firefox */
.leaflet-right-popup {
scrollbar-width: thin;
scrollbar-color: rgba(0, 0, 0, 0.5) transparent; /* Thumb and track colors */
}

/* Scrollbar thumb for Firefox */
.leaflet-right-popup::-webkit-scrollbar-thumb {
border-radius: 8px; /* Rounded corners */
}

/* Button styling */
.button {
background-color: var(--newyellow);
color: black;
font-family: Mochiy Pop One;
font-size: 10px;
padding: 10px;
border: 2px solid black;
cursor: pointer;
text-align: center;
border-radius: 5px;
display: block;
margin: 10px auto; /* Center the button horizontally with auto margins */
width: fit-content; /* Set button width based on its content */
}
/* Button hover effect */
.button:hover {
transform: scale(1.15); /* Increase size by 15% (3px more in every direction) */
}


.leaflet-control-zoom-in {
background-color: yellow  !important;  
color: black;
border: 2px solid black !important;
margin-bottom: 10px !important;
border-radius: 20px !important;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.leaflet-control-zoom-in:hover {
transform: scale(1.25); /* Increase size by 25% */
}

.leaflet-control-zoom-out{
background-color: yellow !important;  
color: black;
border: 2px solid black !important;
border-radius: 20px !important;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.leaflet-control-zoom-out:hover {
transform: scale(1.25); /* Increase size by 25 */
}

/* Style the fullscreen button */
.leaflet-control-fullscreen a {
background-color: yellow !important;  
color: black;
border: 2px solid black !important;
border-bottom: 2px solid black !important;
border-radius: 20px !important;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.leaflet-control-fullscreen a:hover {

transform: scale(1.25); /* Increase size by 25% */
}





</style>
</head>

<body>
<header>
<h1>üêù Travel Map üêù</h1>
</header>
<!-- The map container   <div id="top-div">-->
<div id="map"></div>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css" />
<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>
</div>
<script>
// Initialize the map and set its view to the center of Europe with an appropriate zoom level
var startingZoomLevel = 5;
var map = L.map('map').setView([48.1657, 9.9515], startingZoomLevel);


//Add the OpenStreetMap tile layer
//L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://carto.com/attributions">CARTO</a>',
//maxZoom: 12,
//minZoom: 5
//}).addTo(map);


L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
maxZoom: 12,
minZoom: 5,
}).addTo(map);

// Add fullscreen control to the map
L.control.fullscreen().addTo(map);

// Handle events when entering/exiting fullscreen mode (optional)
map.on('enterFullscreen', function(){
console.log('Entered fullscreen');
});

map.on('exitFullscreen', function(){
console.log('Exited fullscreen');
});	    




//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
//}).addTo(map);

// Load GeoJSON from an external file and add GeoJSON layer to the map once the file is loaded


// Global variable to keep track of the last clicked marker
var lastClickedMarker = null;

// Default content for the right-hand popup
var DefaultPopupContent = '<h2>?!</h2><p>Zoom in and click on a üêù, or navigate the list :)</p>' + 
'<button class="button" onclick="setLegendPopupContent()">View Legend</button>' +
'<button class="button" onclick="setListPopupContent()">View List</button>';

// Create a custom control for the right-hand side popup
var rightSidePopup = L.Control.extend({
onAdd: function(map) {
var div = L.DomUtil.create('div', 'leaflet-right-popup');
div.innerHTML = DefaultPopupContent; // Set default content initially
return div;
}
});

// Add the control to the map
var rightPopupControl = new rightSidePopup({ position: 'topright' });
map.addControl(rightPopupControl);

// Reference to the control's div for updating content
var rightPopupDiv = document.querySelector('.leaflet-right-popup');

// Function to reset the right-hand popup to the default content
function setDefaultPopupContent() {
rightPopupDiv.innerHTML = DefaultPopupContent;

if (lastClickedMarker) {
lastClickedMarker.setIcon(DefaultMarkerIcon);
lastClickedMarker = null;  // Clear the lastClickedMarker after resetting
}
}

// Function to set the legend content in the right-hand popup
function setLegendPopupContent() {
rightPopupDiv.innerHTML = '<h2>Legend:</h2>' + 
'<img src="MyBeeKey.png" style="width: auto; height: auto;">' + '<p> Map inspired by the German idiom - "Du hast hummeln im Hinternüêù" <br> This expression, out of the many I have learnt while on my OE, left a lasting impression and inspired the theme of this map. <br> Translated to English, it means you got bees in your bottom. Still confused? So was I, so it was further explained that your bottom is at such a risk of beeing stung that your always moving. In my case, traveling through 11 countires.  </p>'+
'<button class="button" onclick="setDefaultPopupContent()">Buzz off</button>';

if (lastClickedMarker) {
lastClickedMarker.setIcon(DefaultMarkerIcon);
lastClickedMarker = null;
}
}

// Function to set the list content inside the popup
function setListPopupContent() {
// Set the HTML content of the popup, including a header and a button
rightPopupDiv.innerHTML = `
   <h2>Places I have üêù-n</h2>
   <div id="nameList"></div> <!-- This is where the list will be inserted -->
   <button class="button" onclick="setDefaultPopupContent()">Buzz off</button>
 `;

// Now, after setting the popup content, create the list dynamically
createClickableList(); // This function will populate the list inside #nameList
}

// Function to update the right-hand popup content with marker info
function updateRightPopup(properties, latlng) {
var subtext = properties.words || ''; // Show subtext if available
rightPopupDiv.innerHTML = '<h2>' + properties.name + '</h2> \n <img src="fotos/' + properties.abv + '.jpeg" alt="4üêù4" style="width: 100%;'+
'height: auto; object-fit: contain;"> \n <p>' + subtext + '</p> \n <button class="button" onclick="setDefaultPopupContent()">Buzz off</button>'+
'<button class="button" onclick="setListPopupContent()">View List</button>';
}

//---------------------------------   POINT LAYER   --------------------------------------------

// Marker icons for different states
var DefaultMarkerIcon = L.icon({
iconUrl: 'beeIconMod.png',
iconSize: [50, 50]
});

var HoverMarkerIcon = L.icon({
iconUrl: 'beeIconMod.png',
iconSize: [75, 75]
});

var PopupMarkerIcon = L.icon({
iconUrl: 'BuzzBee40.gif',
iconSize: [80, 75]
});

var geoJsonLayer;  // GeoJSON Layer
var markers = {};   // Store markers by name for easy lookup
var lastClickedMarker = null; // To keep track of the last clicked marker

// Function to add GeoJSON layer but not immediately to the map
function addGeoJsonLayer() {
geoJsonLayer = L.geoJSON(geoJsonData, {
pointToLayer: function(feature, latlng) {
var marker = L.marker(latlng, { icon: DefaultMarkerIcon });

var HoverContent = feature.properties.name;

// Bind tooltip (shown on hover)
marker.bindTooltip(HoverContent, {
offset: [0, -10], // Just a little bit up
permanent: false,
direction: 'top',
className: 'custom-tooltip'
});

// Event listener for marker click (updates right-hand popup and changes icon)
marker.on('click', function() {
// Same behavior as clicking the name from the list
handleMarkerClick(marker, feature, latlng);
});

// Hover behavior
marker.on('mouseover', function() {
if (!this.isPopupOpen() && this !== lastClickedMarker) {
this.setIcon(HoverMarkerIcon);
this.openTooltip();
}
});

marker.on('mouseout', function() {
if (!this.isPopupOpen() && this !== lastClickedMarker) {
this.setIcon(DefaultMarkerIcon);
this.closeTooltip();
}
});

// Store marker in global markers object by name
markers[feature.properties.name] = marker;

// Return marker without adding it to the map yet
return marker;

}
});

}

// Function to handle layer visibility based on zoom level and feature properties
function updateLayerVisibility() {
var zoom = map.getZoom();
geoJsonLayer.eachLayer(function(layer) {
var weight = layer.feature.properties.weight; // Get the weight of each layer

// Remove all layers if zoom is less than 7
if (zoom < 6) {
if (map.hasLayer(layer)) {
map.removeLayer(layer); // Remove any layers that are already added
}
} 
// Show only layers with weight 1 if zoom is 7 or more
else if (zoom >= 6 && zoom < 7) {
if (weight === 1 && !map.hasLayer(layer)) {
map.addLayer(layer); // Add layer with weight 1
} else if (weight !== 1 && map.hasLayer(layer)) {
map.removeLayer(layer); // Remove layers that don't have weight 1
}
} 
// Show layers with weight 1 and 2 if zoom is 9 or more
else if (zoom >= 7 && zoom < 8) {
if ((weight === 1 || weight === 2) && !map.hasLayer(layer)) {
map.addLayer(layer); // Add layers with weight 1 or 2
} else if (weight > 2 && map.hasLayer(layer)) {
map.removeLayer(layer); // Remove layers that don't match the weight condition
}
} 
// Show layers with weight 1, 2, and 3 if zoom is 10 or more
else if (zoom >= 10) {
if ((weight === 1 || weight === 2 || weight === 3) && !map.hasLayer(layer)) {
map.addLayer(layer); // Add layers with weight 1, 2, or 3
}
}
});
}

// Function to handle actions when a marker is clicked or a name is clicked from the list
function handleMarkerClick(marker, feature, latlng) {
// Reset the last clicked marker if necessary
if (lastClickedMarker && lastClickedMarker !== marker) {
lastClickedMarker.setIcon(DefaultMarkerIcon); // Reset previous marker
}

lastClickedMarker = marker; // Set the current marker as last clicked
marker.setIcon(PopupMarkerIcon); // Change to popup icon
marker.openPopup(); // Open the popup for the clicked marker

updateRightPopup(feature.properties, latlng); // Update the right-side popup
}

// Create the clickable list from GeoJSON properties
function createClickableList() {
var nameListDiv = document.getElementById('nameList');
var names = [];

// Loop through GeoJSON features and collect names
geoJsonData.features.forEach(function(feature) {
if (feature.properties && feature.properties.name) {
names.push({
name: feature.properties.name,
latlng: feature.geometry.coordinates ? L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]) : null
});
}
});

// Sort the names alphabetically
names.sort(function(a, b) {
return a.name.localeCompare(b.name);
});

// Create list items for each name and add them to the popup content
names.forEach(function(item) {
var listItem = document.createElement('div');
listItem.classList.add('name-item');
listItem.textContent = item.name;

// When a name is clicked, zoom to the marker and trigger the same behavior as a marker click
listItem.addEventListener('click', function() {
var marker = markers[item.name];  // Retrieve marker by name
if (marker) {
handleMarkerClick(marker, geoJsonData.features.find(f => f.properties.name === item.name));
map.setView(item.latlng, 11);  // Zoom to the marker

}
});

// Append the list item to the #nameList div inside the popup
nameListDiv.appendChild(listItem);
});
}


// Load the GeoJSON data and add it to the map
$.getJSON("orte.geojson")
.done(function(loadedData) {
geoJsonData = loadedData; // Store loaded data globally
console.log("GeoJSON data loaded: ", geoJsonData); // Log the loaded data
addGeoJsonLayer(); // Add the GeoJSON layer after the data is loaded

// Initialize visibility based on the initial zoom level
updateLayerVisibility();
createClickableList();
})
.fail(function(jqxhr, textStatus, error) {
var err = textStatus + ", " + error;
console.error("GeoJSON load failed: " + err); // Log the error
});

// Listen for zoom changes and update layer visibility
map.on('zoomend', updateLayerVisibility);



//---------------------------------   POLYGON LAYER   --------------------------------------------

// Define the initial style for the polygon
var initialOpacity = 0.8; // Fully opaque	    
//adding hexpolygons
var GeoJsonSource = $.getJSON("Hex_cells.geojson", function(data) {
var HexLayer = L.geoJSON(data, {
style: function(feature) {
var fillColor,
density = feature.properties.NUMPOINTS;
if ( density > 6.0 ) fillColor = "#ff841f";
else if ( density > 5.0 ) fillColor = "#ffb61f";
else if ( density > 3.0 ) fillColor = "#ffe91f";
else if ( density > 2.0 ) fillColor = "#ffff6a";
else if ( density >= 1.0 ) fillColor = "#ffff9b";
else fillColor = "#000000";  // no data
return { color: "yellow", weight: 3, fillColor: fillColor, initialOpacity}; //see above for initial Opacity variable.

}
}).addTo(map);

// Define the function to adjust opacity based on zoom level
function adjustOpacityBasedOnZoom() {
var zoomLevel = map.getZoom();

// Calculate new opacity, decrease by 0.1 for each zoom level above a base level
var newOpacity = initialOpacity - (zoomLevel - startingZoomLevel) * 0.15;
var newOpacity = Math.max(0, newOpacity); // Ensure opacity doesn't go below 0

// Update the style of the GeoJSON layer
HexLayer.setStyle({
fillOpacity: newOpacity
});
}

// Attach the function to the zoomend event
map.on('zoomend', adjustOpacityBasedOnZoom);

// Adjust opacity initially
adjustOpacityBasedOnZoom();
});
</script>
<div id="bottom-div">

<p>Johann Rosteck | Kissick, 2025 </p>

</div>  	  
</body>
</html>
~
