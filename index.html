
<html>
  <head> <!--this is metadata -->
    <title>Travel Map</title>
    <!-- Include Leaflet CSS and JS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

        <!-- Fullscreen plugin CSS and JS -->
        <link rel="stylesheet" href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css" />
        <script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>

        <!-- JQuery -->
        <script src="jquery-2.1.1.min.js"></script> 

	  <!-- Fonts -->
    	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    	<style>
		
	 html, body {
            height: 100%;
            margin: 0;
            font-family: Arial, Helvetica, sans-serif
        }

        header {
            /*position: fixed;  Keep the header fixed at the top */
            top: 0;
            left: 0;
            width: 100%; /* Full width */
            background-color: yellow; /* Background color */
            padding: 10px; /* Space inside the header */
            box-sizing: border-box;
            z-index: 1000; /* Ensure it stays above other content */
        }

        body {
            display: flex;
	    flex-direction: column;
            justify-content: center;
            align-items: center;
        }
	#top-div {
            width: 1000px;
            height: 800px; /*can#t go more than this for some reason*/
            background-color: white;
	}  

  /* Ensure the map container is set to fill the available screen space */
      #map {
            width: 100%;  /* The map should take up the full width of its container */
            height: 100%;
}


	    #bottom-div {
            width: 1000px;
            height: 50px;
            background-color: yellow;
	}	
        h1 {
            color: black;
            font-family: Mochiy Pop One;
            font-size: 400%;
            text-align: center;
            margin: 0;
        }
	    
	h2 {
            color: black;
            font-family: Mochiy Pop One;
            font-size: 250%;
            text-align: center;
            margin: 0;
        }
	p {
            color: black;
            font-family: Arial, Helvetica, sans-serif;
	}
	.mochiy-pop-one-regular {
  font-family: "Mochiy Pop One", sans-serif;
  font-weight: 400;
  font-style: normal;
}

.leaflet-touch .leaflet-control-layers, .leaflet-touch .leaflet-bar {
    border: #ffffff00;
    background-clip: padding-box;
}

		/* Change the popup background color and text color */
.leaflet-tooltip {
      margin-top: -30px; /* Move tooltip content 30px up */
      background-color: yellow; 
      border-radius: 5px; /* Rounded corners */
      border: 2px solid black; /* Dark grey border */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      text-align: center;  /* Center the content */
      color: black; /* Dark text */
      font-size: 12pt;
      font-weight: bold; /* Bold text */
      font-family: Mochiy Pop One;
  } 
	    	  
	  
 /* Custom popup style on the right side inside the map frame */
    .leaflet-right-popup {
    /*position: absolute;*/
    max-width: 30% !important;/* Set the width to 30% of the map's width */ 
    right: 5px;
    top: 5px;/*this is offset*/
    background: yellow;
    border: 2px solid black; /* Dark grey border */
    padding: 1px; /*inside content*/
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    
    /* Scrollbar settings */
    max-height: 750px;  /*Adjust this value to control the popup height */
    overflow-y: auto; /* Add vertical scroll if content overflows */
    /* Add padding to make scrollbar fit within rounded edges */
    padding-right:10px;
}

/* WebKit browsers */
.leaflet-right-popup::-webkit-scrollbar {
    width: 30px; /* Width of the scrollbar */
    border-radius: 8px; /* Round the scrollbar to match the popup */
}

.leaflet-right-popup::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.5); /* Color of the scrollbar thumb */
    border-radius: 8px; /* Match the rounded corners */
}

.leaflet-right-popup::-webkit-scrollbar-track {
    background: transparent; /* Transparent track to blend with the background */
    border-radius: 8px; /* Round the track as well */
}

/* For Firefox */
.leaflet-right-popup {
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.5) transparent; /* Thumb and track colors */
}

/* Scrollbar thumb for Firefox */
.leaflet-right-popup::-webkit-scrollbar-thumb {
    border-radius: 8px; /* Rounded corners */
}

/* Button styling */
        .button {
	    background-color: rgb(202, 133, 6);
            color: black;
            font-family: Mochiy Pop One;
            padding: 10px;
            border: black;
            cursor: pointer;
            text-align: center;
            border-radius: 5px;
            display: block;
            margin: 10px auto; /* Center the button horizontally with auto margins */
            width: fit-content; /* Set button width based on its content */
}
.leaflet-control-zoom-in {
	background-color: yellow !important;  
    color: black;
    border: 2px solid black !important;
    margin-bottom: 10px !important;
    border-radius: 20px !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);


}
.leaflet-control-zoom-out{
	background-color: yellow !important;  
    color: black;
    border: 2px solid black !important;
    border-radius: 20px !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

/* Style the fullscreen button */
.leaflet-control-fullscreen a {
    background-color: yellow !important;  
    color: black;
    border: 2px solid black !important;
    border-bottom: 2px solid black !important;
    border-radius: 20px !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}
        
  


	  
    </style>
  </head>
 
  <body>
    <header>
      <h1>üêùhold my map</h1>
    </header>
    <!-- The map container -->
    <div id="top-div">
	    <div id="map"></div>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css" />
    <script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>
	</div>
    <script>
  // Initialize the map and set its view to the center of Europe with an appropriate zoom level
  var startingZoomLevel = 5;
    var map = L.map('map').setView([48.1657, 9.9515], startingZoomLevel);
	
  
  //Add the OpenStreetMap tile layer
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://carto.com/attributions">CARTO</a>',
	maxZoom: 12,
      	minZoom: 5
}).addTo(map);


//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  //}).addTo(map);
  
 // Add fullscreen control to the map
L.control.fullscreen().addTo(map);

// Handle events when entering/exiting fullscreen mode (optional)
map.on('enterFullscreen', function(){
    console.log('Entered fullscreen');
});

map.on('exitFullscreen', function(){
    console.log('Exited fullscreen');
});	    




//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  //}).addTo(map);
  
  // Load GeoJSON from an external file and add GeoJSON layer to the map once the file is loaded

    
// Global variable to keep track of the last clicked marker
var lastClickedMarker = null;

// Default content for the right-hand popup
var DefaultPopupContent = '<h3>Zoom in, then click a üêù to see where I was.</h3>' + 
  '<button class="button" onclick="setLegendPopupContent()">View Legend</button>';

// Create a custom control for the right-hand side popup
var rightSidePopup = L.Control.extend({
  onAdd: function(map) {
    var div = L.DomUtil.create('div', 'leaflet-right-popup');
    div.innerHTML = DefaultPopupContent; // Set default content initially
    return div;
  }
});

// Add the control to the map
var rightPopupControl = new rightSidePopup({ position: 'topright' });
map.addControl(rightPopupControl);

// Reference to the control's div for updating content
var rightPopupDiv = document.querySelector('.leaflet-right-popup');

// Function to reset the right-hand popup to the default content
function setDefaultPopupContent() {
  rightPopupDiv.innerHTML = DefaultPopupContent;
  
  if (lastClickedMarker) {
    lastClickedMarker.setIcon(DefaultMarkerIcon);
    lastClickedMarker = null;  // Clear the lastClickedMarker after resetting
  }
}

// Function to set the legend content in the right-hand popup
function setLegendPopupContent() {
  rightPopupDiv.innerHTML = '<h3>Legend:</h3>' + 
    '<img src="BeeKey.jpeg" style="width: 100%; height: auto;">' + 
    '<button class="button" onclick="setDefaultPopupContent()">Buzz off</button>';
  
  if (lastClickedMarker) {
    lastClickedMarker.setIcon(DefaultMarkerIcon);
    lastClickedMarker = null;
  }
}

// Function to update the right-hand popup content with marker info
function updateRightPopup(properties, latlng) {
  var subtext = properties.words || ''; // Show subtext if available
  rightPopupDiv.innerHTML = '<h2>' + properties.name + '</h2>' + subtext + 
    '<img src="fotos/' + properties.abv + '.jpeg" alt="nope" style="width: 100%; height: auto;">' +
    '<button class="button" onclick="setDefaultPopupContent()">Buzz off</button>';
}
//---------------------------------   POINT LAYER   --------------------------------------------

// Marker icons for different states
 var DefaultMarkerIcon = L.icon({
  iconUrl: 'beeIconMod.png',
  iconSize: [50, 50]
});

var HoverMarkerIcon = L.icon({
  iconUrl: 'beeIconMod.png',
  iconSize: [75, 75]
});

var PopupMarkerIcon = L.icon({
  iconUrl: 'BuzzBee40.gif',
  iconSize: [80, 75]
});

// Function to add GeoJSON layer but not immediately to the map
function addGeoJsonLayer() {
  geoJsonLayer = L.geoJSON(geoJsonData, {
    pointToLayer: function(feature, latlng) {
      var marker = L.marker(latlng, { icon: DefaultMarkerIcon });

      var HoverContent = feature.properties.name;

      // Bind tooltip (shown on hover)
      marker.bindTooltip(HoverContent, {
        offset: [0, -30],
        permanent: false,
        direction: 'top',
        className: 'custom-tooltip'
      });

      // Event listener for marker click (updates right-hand popup and changes icon)
      marker.on('click', function() {
        if (lastClickedMarker && lastClickedMarker !== marker) {
          lastClickedMarker.setIcon(DefaultMarkerIcon); // Reset previous marker
        }

        lastClickedMarker = marker; // Set the current marker as last clicked

        this.setIcon(PopupMarkerIcon); // Change to popup icon

        updateRightPopup(feature.properties, latlng); // Update popup
      });

      // Hover behavior
      marker.on('mouseover', function() {
        if (!this.isPopupOpen() && this !== lastClickedMarker) {
          this.setIcon(HoverMarkerIcon);
          this.openTooltip();
        }
      });

      marker.on('mouseout', function() {
        if (!this.isPopupOpen() && this !== lastClickedMarker) {
          this.setIcon(DefaultMarkerIcon);
          this.closeTooltip();
        }
      });

      // Return marker without adding it to the map yet
      return marker;
    }
});
}

// Function to handle layer visibility based on zoom level and feature properties
function updateLayerVisibility() {
  var zoom = map.getZoom();
  geoJsonLayer.eachLayer(function(layer) {
  var weight = layer.feature.properties.weight; // Get the weight of each layer

  // Remove all layers if zoom is less than 7
  if (zoom < 7) {
    if (map.hasLayer(layer)) {
      map.removeLayer(layer); // Remove any layers that are already added
    }
  } 
  // Show only layers with weight 1 if zoom is 7 or more
  else if (zoom >= 7 && zoom < 8) {
    if (weight === 1 && !map.hasLayer(layer)) {
      map.addLayer(layer); // Add layer with weight 1
    } else if (weight !== 1 && map.hasLayer(layer)) {
      map.removeLayer(layer); // Remove layers that don't have weight 1
    }
  } 
  // Show layers with weight 1 and 2 if zoom is 9 or more
  else if (zoom >= 8 && zoom < 9) {
    if ((weight === 1 || weight === 2) && !map.hasLayer(layer)) {
      map.addLayer(layer); // Add layers with weight 1 or 2
    } else if (weight > 2 && map.hasLayer(layer)) {
      map.removeLayer(layer); // Remove layers that don't match the weight condition
    }
  } 
  // Show layers with weight 1, 2, and 3 if zoom is 10 or more
  else if (zoom >= 9) {
    if ((weight === 1 || weight === 2 || weight === 3) && !map.hasLayer(layer)) {
      map.addLayer(layer); // Add layers with weight 1, 2, or 3
    }
  }
});
}


// Load the GeoJSON data and add it to the map
$.getJSON("orte.geojson")
  .done(function(loadedData) {
    geoJsonData = loadedData; // Store loaded data globally
    console.log("GeoJSON data loaded: ", geoJsonData); // Log the loaded data
    addGeoJsonLayer(); // Add the GeoJSON layer after the data is loaded

    // Initialize visibility based on the initial zoom level
    updateLayerVisibility();
  })
  .fail(function(jqxhr, textStatus, error) {
    var err = textStatus + ", " + error;
    console.error("GeoJSON load failed: " + err); // Log the error
  });

// Listen for zoom changes and update layer visibility
map.on('zoomend', updateLayerVisibility);

//properties.weight 

//---------------------------------   POLYGON LAYER   --------------------------------------------

// Define the initial style for the polygon
var initialOpacity = 0.8; // Fully opaque	    
//adding hexpolygons
var GeoJsonSource = $.getJSON("Hex_cells.geojson", function(data) {
  var HexLayer = L.geoJSON(data, {
    style: function(feature) {
	var fillColor,
          density = feature.properties.NUMPOINTS;
      if ( density >= 8.0 ) fillColor = "#ff841f";
      else if ( density >= 4.0 ) fillColor = "#ffb61f";
      else if ( density >= 3.0 ) fillColor = "#ffe91f";
      else if ( density >= 2.0 ) fillColor = "#ffff6a";
      else if ( density >= 1.0 ) fillColor = "#ffff9b";
      else fillColor = "#000000";  // no data
      return { color: "yellow", weight: 3, fillColor: fillColor, initialOpacity}; //see above for initial Opacity variable.

    }
  }).addTo(map);

// Define the function to adjust opacity based on zoom level
function adjustOpacityBasedOnZoom() {
    var zoomLevel = map.getZoom();
    
    // Calculate new opacity, decrease by 0.1 for each zoom level above a base level
    var newOpacity = initialOpacity - (zoomLevel - startingZoomLevel) * 0.15;
    var newOpacity = Math.max(0, newOpacity); // Ensure opacity doesn't go below 0
    
    // Update the style of the GeoJSON layer
    HexLayer.setStyle({
        fillOpacity: newOpacity
    });
}

// Attach the function to the zoomend event
map.on('zoomend', adjustOpacityBasedOnZoom);

// Adjust opacity initially
adjustOpacityBasedOnZoom();
});
</script>
<div id="bottom-div">
	  
	<h2><br>Du hast Hummeln im Hinternüêù</h2>
	  
	<p>This expression, out of the many I have learnt while on my OE, left a lasting impression and inspired the theme of this map. <br> 
		Translated to English, it means you got bees in your bottom. Still confused? So was I, so it was further explained that your bottom is at such a risk of beeing stung that your always moving. In my case, traveling through 11 countires.  </p>
</div>  	  
  </body>
</html>

