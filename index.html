
<html>
  <head> <!--this is metadata -->
    <title>My Travelmap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="jquery-2.1.1.min.js"></script> 
    <style>
	 html, body {
            height: 100%;
            margin: 0;
            font-family: Brush Script MT, sans-serif;
        }

        header {
            position: fixed; /* Keep the header fixed at the top */
            top: 0;
            left: 0;
            width: 100%; /* Full width */
            background-color: yellow; /* Background color */
            padding: 10px; /* Space inside the header */
            box-sizing: border-box;
            z-index: 1000; /* Ensure it stays above other content */
        }

        body {
            padding-top: 60px; /* Offset body content by header height */
            display: flex;
		flex-direction: column;
            justify-content: center;
            align-items: center;
        }
	#top-div {
            width: 900px;
            height: 550px;
            background-color: white;
	}   
	    #map {
            width: 900px;
            height: 550px;
            background-color: #eee; /* Background color for visibility */
        }	
	    #bottom-div {
            width: 900px;
            height: 250px;
            background-color: yellow;
	}	
        h1 {
            color: black;
            font-family: Brush Script MT, sans-serif;
            font-size: 400%;
            text-align: center;
            margin: 0;
        }
	    
	h2 {
            color: black;
            font-family: Brush Script MT, sans-serif;
            font-size: 250%;
            text-align: center;
            margin: 0;
        }
	p {
            color: black;
            font-family: Brush Script MT, sans-serif;
	}
		/* Change the popup background color and text color */
.leaflet-tooltip {
      margin-top: -30px; /* Move tooltip content 30px up */
      background-color: blue; 
      border-radius: 5px; /* Rounded corners */
      border: 2px solid black; /* Dark grey border */
        text-align: center;  /* Center the content */
	color: black; /* Dark text */
	font-size: 12pt;
	font-weight: bold; /* Bold text */
	font-family: Comic Sans MS;
  } 
	    
/* Hide the tooltip pointer (arrow) */
.leaflet-tooltip .leaflet-tooltip-tip {
  display: none; /* Hide the tooltip arrow */
}
	    
.leaflet-popup-content-wrapper {
     transform: translateY(-30px); 
      background-color: yellow; 
      border-radius: 5px; /* Rounded corners */
      border: 2px solid black; /* Dark grey border */
        text-align: center;  /* Center the content */
	color: black; /* Dark text */
	font-size: 12pt;
	font-weight: bold; /* Bold text */
	font-family: Comic Sans MS;
  }

  /* Change the color of the popup tip (the little triangle) */
  .leaflet-popup-tip {
      display: none;
    </style>
  </head>
 
  <body>
    <header>
      <h1>places I haveüêù-n to!</h1>
    </header>
    <!-- The map container -->
    <div id="top-div">
	    <div id="map"></div>
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.js"></script>
	</div>
    <script>
  // Initialize the map and set its view to the center of Europe with an appropriate zoom level
  var startingZoomLevel = 5;
  var map = L.map('map').setView([48.1657, 9.4515], startingZoomLevel);
	
  
  //Add the OpenStreetMap tile layer
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://carto.com/attributions">CARTO</a>',
	maxZoom: 12,
      	minZoom: 5
}).addTo(map);


//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  //}).addTo(map);
  
 // Add fullscreen control to the map
L.control.fullscreen().addTo(map);

// Handle events when entering/exiting fullscreen mode (optional)
map.on('enterFullscreen', function(){
    console.log('Entered fullscreen');
});

map.on('exitFullscreen', function(){
    console.log('Exited fullscreen');
});	    

//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  //}).addTo(map);
  
  // Load GeoJSON from an external file and add GeoJSON layer to the map once the file is loaded
// load GeoJSON from an external file
// Define custom icons
var DefaultMarkerIcon = L.icon({
  iconUrl: 'beeIconMod.png', // Attribution: <a href="https://www.flaticon.com/free-icons/bee" title="bee icons">Bee icons created by juicy_fish - Flaticon</a>
  iconSize: [50, 50]
});

var HoverMarkerIcon = L.icon({
  iconUrl: 'beeIconMod.png', // Attribution: <a href="https://www.flaticon.com/free-icons/bee" title="bee icons">Bee icons created by juicy_fish - Flaticon</a>
  iconSize: [75, 75]
});

var PopupMarkerIcon = L.icon({
  iconUrl: 'BuzzBee40.gif', // Attribution: <a href="https://www.flaticon.com/free-icons/bee" title="bee icons">Bee icons created by juicy_fish - Flaticon</a>
  iconSize: [80, 75]
});

// Declare a variable to store the GeoJSON data globally
var geoJsonData;
var geoJsonLayer;

// Function to add the GeoJSON layer to the map
function addGeoJsonLayer() {
  geoJsonLayer = L.geoJSON(geoJsonData, {
    pointToLayer: function(feature, latlng) {
      var marker = L.marker(latlng, { icon: DefaultMarkerIcon }); // Set default icon

      var HoverContent = feature.properties.name;
      var PopupContent = '<div class="custom-popup">' +
                         '<img src="fotos/' + feature.properties.fotoID + '" alt="Foto nicht gefunden" style="width: 200px; height: auto;">' +
                         '<br>' + feature.properties.name +
                         '</div>';

      // Bind tooltip (shown on hover) 
      marker.bindTooltip(HoverContent, { 
          offset: [0, -55], //(this is 50px icon size + 25 to compensate for when hover or click icon is on)
	  permanent: false, 
          direction: 'top'
      });

      // Bind popup initially
      marker.bindPopup(PopupContent);

      // Event listener for marker click (opens popup and changes icon)
      marker.on('click', function() {
          this.setIcon(PopupMarkerIcon);  // Change to popup icon on click
          this.unbindTooltip();           // Disable tooltip when popup is open
          this.bindPopup(PopupContent).openPopup();  // Show the popup
      });

      // Ensure icon stays as PopupMarkerIcon when the popup is open
      marker.on('popupopen', function() {
          this.setIcon(PopupMarkerIcon);  // Ensure icon remains PopupMarkerIcon
      });

      // Revert to default icon when the popup is closed
      marker.on('popupclose', function() {
          this.setIcon(DefaultMarkerIcon);  // Revert to the default icon when the popup is closed
          this.bindTooltip(HoverContent, {  // Re-enable the tooltip
              permanent: false, 
              direction: 'top',
              className: 'custom-tooltip'
          });
      });

      // Event listener for mouseover (hover) - show tooltip and change icon
      marker.on('mouseover', function() {
          if (!this.isPopupOpen()) {  // Only change to HoverMarkerIcon if popup is not open
              this.setIcon(HoverMarkerIcon);
              this.openTooltip();  // Show the tooltip on hover
          }
      });

      // Event listener for mouseout - revert to default icon and close tooltip
      marker.on('mouseout', function() {
          if (!this.isPopupOpen()) {  // Only revert to DefaultMarkerIcon if popup is not open
              this.setIcon(DefaultMarkerIcon);
              this.closeTooltip();  // Hide the tooltip when not hovering
          }
      });

      return marker;
    }
  }).addTo(map);
}

// Function to update layer visibility based on zoom level
function updateLayerVisibility() {
  var zoom = map.getZoom();
  
  if (zoom < 7 && geoJsonLayer) {
    // Remove the layer if the zoom level is less than 7
    map.removeLayer(geoJsonLayer);
    geoJsonLayer = null;
  } else if (zoom >= 7 && !geoJsonLayer) {
    // Re-add the layer if the zoom level is 7 or higher and the layer doesn't exist
    addGeoJsonLayer();
  }
}

// Fetch GeoJSON data and store it globally
$.getJSON("test.geojson", function(loadedData) {
  geoJsonData = loadedData; // Store the data globally

  // Initialize visibility based on the initial zoom level
  updateLayerVisibility();
});

// Update layer visibility on zoom end
map.on('zoomend', updateLayerVisibility);



// Define the initial style for the polygon
var initialOpacity = 0.8; // Fully opaque	    
//adding hexpolygons
var GeoJsonSource = $.getJSON("hex_test_reproject.geojson", function(data) {
  var HexLayer = L.geoJSON(data, {
    style: function(feature) {
	var fillColor,
          density = feature.properties.NUMPOINTS;
      if ( density >= 8.0 ) fillColor = "#ff841f";
      else if ( density >= 4.0 ) fillColor = "#ffb61f";
      else if ( density >= 3.0 ) fillColor = "#ffe91f";
      else if ( density >= 2.0 ) fillColor = "#ffff6a";
      else if ( density >= 1.0 ) fillColor = "#ffff9b";
      else fillColor = "#000000";  // no data
      return { color: "yellow", weight: 3, fillColor: fillColor, initialOpacity}; //see above for initial Opacity variable.

    }
  }).addTo(map);

// Define the function to adjust opacity based on zoom level
function adjustOpacityBasedOnZoom() {
    var zoomLevel = map.getZoom();
    
    // Calculate new opacity, decrease by 0.1 for each zoom level above a base level
    var newOpacity = initialOpacity - (zoomLevel - startingZoomLevel) * 0.15;
    var newOpacity = Math.max(0, newOpacity); // Ensure opacity doesn't go below 0
    
    // Update the style of the GeoJSON layer
    HexLayer.setStyle({
        fillOpacity: newOpacity
    });
}

// Attach the function to the zoomend event
map.on('zoomend', adjustOpacityBasedOnZoom);

// Adjust opacity initially
adjustOpacityBasedOnZoom();
});
</script>
<div id="bottom-div">
	  
	<h2><br>Du hast Hummeln im Hinternüêù</h2>
	  
	<p>This expression, out of the many I have learnt while on my OE, left a lasting impression and inspired the theme of this map. <br> 
		Translated to English, it means you got bees in your bottom. Still confused? So was I, so it was further explained that your bottom is at such a risk of beeing stung that your always moving. In my case, traveling through 11 countires.  </p>
</div>  	  
  </body>
</html>
